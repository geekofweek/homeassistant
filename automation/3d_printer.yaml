#################################################################
## 3D Printer Automations
#################################################################

#################################################################
## Prusa MK4S
#################################################################

        ##########################################################
        ## Prusa MK4S 3D Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Finished
  id: '3d_printer_prusa_mk4s_print_finished'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'finished'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: 3D Print Complete (MK4S)
        data:
          tag: prusa_mk4s_finished
          group: 3d_printer
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Stopped
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Stopped
  id: '3d_printer_prusa_mk4s_print_stopped'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'stopped'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "purple"
    - action: notify.USER1_devices
      data:
        message: Print Stopped (MK4S)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Paused
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Paused
  id: '3d_printer_prusa_mk4s_print_paused'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'paused'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "orangered"
    - action: notify.USER1_devices
      data:
        message: Print Paused (MK4S)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Error
  id: '3d_printer_prusa_mk4s_print_error'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'error'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Error (MK4S)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## Prusa MK4S Print Attention
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Print Attention
  id: '3d_printer_prusa_mk4s_print_attention'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'attention'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Needs Attention (MK4S)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s

        ##########################################################
        ## MK4S On Turn On Light
        ##########################################################

- alias: 3D-Printer - MK4S On Turn On Light
  id: '3d_printer_mk4s_on_turn_on_light'

  trigger:
    - platform: state
      entity_id: switch.prusa_mk4s
      to: 'on'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'off'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## 3D Printer MK4S Off Turn Off Light
        ##########################################################

- alias: 3D-Printer - MK4S Off Turn Off Light
  id: '3d_printer_mk4s_off_turn_off_light'

  trigger:
    - platform: state
      entity_id: switch.prusa_mk4s
      to: 'off'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  action:
    - action: light.turn_off
      target:
        entity_id:
          - light.prusa_mk4s

        ##########################################################
        ## MK4S Light Reset if Idle
        ##########################################################

- alias: 3D-Printer - MK4S Light Reset if Idle
  id: '3d_printer_mk4s_light_reset_if_idle'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'idle'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'idle'
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S Light Print Start
        ##########################################################

- alias: 3D-Printer - MK4S Light Print Start
  id: '3d_printer_mk4s_light_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  condition:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  action:
    - action: light.turn_on
      entity_id:
        - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "blue"
    - delay: '00:05:00'
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S Light Print Finish
        ##########################################################

- alias: 3D-Printer - MK4S Light Print Finish
  id: '3d_printer_mk4s_light_print_finish'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'finished'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        color_name: "green"

        ##########################################################
        ## 3D Printer Light MK4S Print Finish Reset
        ##########################################################

- alias: 3D-Printer - Light MK4S Print Finish Reset
  id: '3d_printer_light_mk4s_print_finish_reset'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'finished'
      to: 'idle'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s
      state: 'on'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## Prusa MK4S Enclosure Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan On Temp
  id: '3d_printer_prusa_mk4s_enclosure_fan_on_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 26
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ASA'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan On Temp
  id: '3d_printer_prusa_mk4s_psu_fan_on_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 30
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_material
          state: 'ASA'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fan Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan Off Temp
  id: '3d_printer_prusa_mk4s_enclosure_fan_off_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 26
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan Off Temp
  id: '3d_printer_prusa_mk4s_psu_fan_off_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 28
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan On Print Start
  id: '3d_printer_prusa_mk4s_enclosure_fan_on_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 26
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan On Print Start
  id: '3d_printer_prusa_mk4s_psu_fan_on_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'off'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      above: 30
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fan Off Print Start
  id: '3d_printer_prusa_mk4s_enclosure_fan_off_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'on'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 26
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan

        ##########################################################
        ## Prusa MK4S PSU Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S PSU Fan Off Print Start
  id: '3d_printer_prusa_mk4s_psu_fan_off_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'on'
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ABS'
        - condition: state
          entity_id: sensor.prusa_mk4s_mmu3_material
          state: 'ASA'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_enclosure_temperature
      below: 28
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fans On Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fans On Print Finished
  id: '3d_printer_prusa_mk4s_enclosure_fans_on_print_finished'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      to: 'finished'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'off'
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## Prusa MK4S Enclosure Fans Off Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S Enclosure Fans Off Print Finished
  id: '3d_printer_prusa_mk4s_enclosure_fans_off_print_finished'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'finished'
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'idle'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_psu_fan
          state: 'on'
        - condition: state
          entity_id: switch.prusa_mk4s_enclosure_fan
          state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## 3D Printer MK4S Off Turn Off Fans
        ##########################################################

- alias: 3D-Printer - MK4S Off Turn Off Fans
  id: '3d_printer_mk4s_off_turn_off_fans'

  trigger:
    - platform: state
      entity_id: switch.prusa_mk4s
      to: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_enclosure_fan
          - switch.prusa_mk4s_psu_fan

        ##########################################################
        ## 3D Printer Turn On Camera Recording Prusa MK4S
        ##########################################################

- alias: 3D-Printer - Turn On Camera Recording Prusa MK4S
  id: '3d_printer_turn_on_camera_recording_prusa_mk4s'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  condition:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_recording_mode
        state: 'Always'

  action:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_recording_mode
        option: "Always"

        ##########################################################
        ## 3D Printer Turn Off Camera Recording Prusa MK4S
        ##########################################################

- alias: 3D-Printer - Turn Off Camera Recording Prusa MK4S
  id: '3d_printer_turn_off_camera_recording_prusa_mk4s'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s
      from: 'printing'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  condition:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_recording_mode
        state: 'Never'

  action:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_recording_mode
        option: "Never"

#################################################################
## Prusa MK4S MMU3
#################################################################

        ##########################################################
        ## Prusa MK4S MMU3 3D Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Finished
  id: '3d_printer_prusa_mk4s_mmu3_print_finished'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'finished'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: 3D Print Complete (MMU)
        data:
          tag: prusa_finished
          group: 3d_printer
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Stopped
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Stopped
  id: '3d_printer_prusa_mk4s_mmu3_print_stopped'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'stopped'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "purple"
    - action: notify.USER1_devices
      data:
        message: Print Stopped (MMU)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Paused
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Paused
  id: '3d_printer_prusa_mk4s_mmu3_print_paused'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'paused'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "orangered"
    - action: notify.USER1_devices
      data:
        message: Print Paused (MMU)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 MMU Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 MMU Print Error
  id: '3d_printer_prusa_mk4s_mmu3_print_error'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_nozzle_temperature
      below: 165
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: Print Error (MMU)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Error
  id: '3d_printer_prusa_mk4s_mmu3_print_error'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'error'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Error (MMU)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 Print Attention
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Print Attention
  id: '3d_printer_prusa_mk4s_mmu3_print_attention'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'attention'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "red"
    - action: notify.USER1_devices
      data:
        message: Print Needs Attention (MMU)
        data:
          tag: prusa_error
          group: 3d_printer
          entity_id: camera.prusa_mk4s_mmu3

        ##########################################################
        ## Prusa MK4S MMU3 On Turn On Light
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 On Turn On Light
  id: '3d_printer_mk4s_mmu3_on_turn_on_light'

  trigger:
    - platform: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'on'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'off'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## 3D Printer MK4S MMU3 Off Turn Off Light
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Off Turn Off Light
  id: '3d_printer_mk4s_mmu3_off_turn_off_light'

  trigger:
    - platform: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'off'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  action:
    - action: light.turn_off
      target:
        entity_id:
          - light.prusa_mk4s_mmu3

        ##########################################################
        ## MK4S MMU3 Light Print Start
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Light Print Start
  id: '3d_printer_mk4s_mmu3_light_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 5

  condition:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "blue"
    - delay: '00:05:00'
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S MMU3 Light Print Finish
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Light Print Finish
  id: '3d_printer_mk4s_mmu3_light_print_finish'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'finished'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        color_name: "green"

        ##########################################################
        ## 3D Printer Light MK4S MMU3 Print Finish Reset
        ##########################################################

- alias: 3D-Printer - Light MK4S MMU3 Print Finish Reset
  id: '3d_printer_light_mk4s_mmu3_print_finish_reset'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'finished'
      to: 'idle'

  condition:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## MK4S MMU3 Light Reset if Idle
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Light Reset if Idle
  id: '3d_printer_mk4s_mmu3_light_reset_if_idle'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'idle'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: state
      entity_id: light.prusa_mk4s_mmu3
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'idle'
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'

  action:
    - action: light.turn_on
      target:
        entity_id:
          - light.prusa_mk4s_mmu3
      data:
        brightness_pct: 100
        effect: Daylight

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan On Temp
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_on_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 26
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'off'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 PSU Fan On Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan On Temp
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_on_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 30
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'off'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan Off Temp
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_off_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 26
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure PSU Off Temp
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan Off Temp
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_off_temp'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 28
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'on'
    - condition: state
      entity_id: sensor.prusa_mk4s_mmu3
      state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan On Print Start
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_on_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'off'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 26
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 PSU Fan On Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan On Print Start
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_on_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'off'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      above: 30
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fan Off Print Start
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fan_off_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'on'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 26
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan

        ##########################################################
        ## Prusa MK4S MMU3 PSU Fan Off Print Start
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 PSU Fan Off Print Start
  id: '3d_printer_prusa_mk4s_mmu3_psu_fan_off_print_start'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'on'
    - condition: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_enclosure_temperature
      below: 28
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fans On Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fans On Print Finished
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fans_on_print_finished'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      to: 'finished'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'off'
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_on
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## Prusa MK4S MMU3 Enclosure Fans Off Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK4S MMU3 Enclosure Fans Off Print Finished
  id: '3d_printer_prusa_mk4s_mmu3_enclosure_fans_off_print_finished'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'finished'
      for:
        hours: 0
        minutes: 30
        seconds: 0
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'idle'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: or
      conditions:
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_psu_fan
          state: 'on'
        - condition: state
          entity_id: switch.prusa_mk4s_mmu3_enclosure_fan
          state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk4s_mmu3
        state: 'printing'
    - condition: state
      entity_id: input_boolean.prusa_mk4s_mmu3_disable_fans
      state: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## 3D Printer MK4S MMU3 Off Turn Off Fans
        ##########################################################

- alias: 3D-Printer - MK4S MMU3 Off Turn Off Fans
  id: '3d_printer_mk4s_mmu3_off_turn_off_fans'

  trigger:
    - platform: state
      entity_id: switch.prusa_mk4s_mmu3
      to: 'off'

  action:
    - action: switch.turn_off
      target:
        entity_id:
          - switch.prusa_mk4s_mmu3_enclosure_fan
          - switch.prusa_mk4s_mmu3_psu_fan

        ##########################################################
        ## 3D Printer Turn On Camera Recording Prusa MK4S MMU3
        ##########################################################

- alias: 3D-Printer - Turn On Camera Recording Prusa MK4S MMU3
  id: '3d_printer_turn_on_camera_recording_prusa_mk4s_mmu3'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      to: 'printing'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  condition:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        state: 'Always'

  action:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        option: "Always"

        ##########################################################
        ## 3D Printer Turn Off Camera Recording Prusa MK4S MMU3
        ##########################################################

- alias: 3D-Printer - Turn Off Camera Recording Prusa MK4S MMU3
  id: '3d_printer_turn_off_camera_recording_prusa_mk4s_mmu3'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk4s_mmu3
      from: 'printing'
      for:
        hours: 0
        minutes: 3
        seconds: 0

  condition:
    - condition: not
      conditions:
      - condition: state
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        state: 'Never'

  action:
    - action: select.select_option
      data:
        entity_id: select.prusa_mk4s_mmu3_camera_recording_mode
        option: "Never"

#################################################################
## Prusa MK3.5
#################################################################

        ##########################################################
        ## Prusa MK3.5 3D Print Finished
        ##########################################################

- alias: 3D-Printer - Prusa MK3.5 Print Finished
  id: '3d_printer_prusa_mk3_5_print_finished'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_5
      from: 'printing'
      to: 'finished'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk3_5
        state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: 3D Print Complete (MK3.5)
        data:
          tag: prusa_finished
          group: 3d_printer

        ##########################################################
        ## Prusa MK3.5 Print Stopped
        ##########################################################

- alias: 3D-Printer - Prusa MK3.5 Print Stopped
  id: '3d_printer_prusa_mk3_5_print_stopped'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_5
      from: 'printing'
      to: 'stopped'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk3_5
        state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: Print Stopped (MK3.5)
        data:
          tag: prusa_error
          group: 3d_printer

        ##########################################################
        ## Prusa MK3.5 Print Paused
        ##########################################################

- alias: 3D-Printer - Prusa MK3.5 Print Paused
  id: '3d_printer_prusa_mk3_5_print_paused'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_5
      from: 'printing'
      to: 'paused'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk3_5
        state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: Print Paused (MK3.5)
        data:
          tag: prusa_error
          group: 3d_printer

        ##########################################################
        ## Prusa MK3.5 MMU Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK3.5 MMU Print Error
  id: '3d_printer_prusa_mk3_5_print_error'

  trigger:
    - platform: numeric_state
      entity_id: sensor.prusa_mk4s_mmu3_nozzle_temperature
      below: 165
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: state
      entity_id: sensor.prusa_mk3_5
      state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: Print Error (MK3.5)
        data:
          tag: prusa_error
          group: 3d_printer

        ##########################################################
        ## Prusa MK3.5 Print Error
        ##########################################################

- alias: 3D-Printer - Prusa MK3.5 Print Error
  id: '3d_printer_prusa_mk3_5_print_error'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_5
      from: 'printing'
      to: 'error'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk3_5
        state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: Print Error (MK3.5)
        data:
          tag: prusa_error
          group: 3d_printer

        ##########################################################
        ## Prusa MK3.5 Print Attention
        ##########################################################

- alias: 3D-Printer - Prusa MK3.5 Print Attention
  id: '3d_printer_prusa_mk3_5_print_attention'

  trigger:
    - platform: state
      entity_id: sensor.prusa_mk3_5
      to: 'attention'

  condition:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.prusa_mk3_5
        state: 'printing'

  action:
    - action: notify.USER1_devices
      data:
        message: Print Needs Attention (MK3.5)
        data:
          tag: prusa_error
          group: 3d_printer